{"version":3,"file":"/js/melangeManager.js","mappings":"MAIA,IAAIA,EAAeC,OAAOC,SAASC,SAAW,KAAOF,OAAOC,SAASE,KAAOH,OAAOC,SAASG,SAExFC,EAAaC,EAAE,aAAaC,KAAK,WAGjCC,GAFcF,EAAE,aAAaC,KAAK,aAEZ,GAqE1B,SAASE,IAEPC,IAAMC,EAAO,yBAEbL,EAAE,mBAAmBC,KAAK,QAASD,EAAE,mBAAmBM,OAExDN,EAAEO,KAAK,CACLH,IACAI,KAAMR,EAAE,mBAAmBS,cAE5BC,MAAK,SAASF,GACb,IAAIG,EAASC,KAAKC,MAAML,GAExBM,EAAcH,EAAOI,GAAI,gBAgF7B,SAA4BJ,GAG1B,IAAIK,EACF,qBAAuBL,EAAOI,GAA9B,0DAEwBJ,EAAOI,GAF/B,+DAGgEJ,EAAOI,GAAI,MAC3EJ,EAAOM,OAAS,KAAON,EAAOO,IAAMP,EAAOO,IAAM,IACjD,kBAEFlB,EAAE,aAAamB,QAAQH,GAEvB,IAAII,EACF,sBAAwBT,EAAOI,GAA/B,oEAEwBJ,EAAOI,GAF/B,gEAGiEJ,EAAOI,GAAI,MAC5EJ,EAAOM,OAAS,KAAON,EAAOO,IAAMP,EAAOO,IAAM,IACjD,kBAEFlB,EAAE,cAAcmB,QAAQC,EAC1B,CApGIC,CAAmBV,EAErB,IACCW,MAAK,SAASd,GACbe,MAAM,uBACR,GACF,CAgCA,SAASlB,EAAOmB,GAId,IAAIC,EAAShC,EAAaiC,OAAO,eAGjC,OAAOjC,EAAakC,QAASlC,EAAamC,UAAUH,GAASD,EAC/D,CAKA,SAASV,EAAce,EAAWC,GAIhC1B,IAAMC,EAAQ,eAAiByB,GAE/B,IAAItB,EAAO,CACT,WAAeT,EACf,UAAc8B,GAIhB7B,EAAEO,KAAK,CACLH,IACAI,KAAMA,IAEPE,MAAK,SAASqB,GACbC,QAAQC,IAAI,kBACd,IACCX,MAAK,SAASY,GACbF,QAAQC,IAAI,WAAaC,EAC3B,GAEF,CA3JAlC,EAAE,eAAemC,GAAG,SAAS,WAC3B,IAAIC,EAAiBpC,EAAE,mBAAmBM,MACxBN,EAAE,gBAAgBM,MAEf,IAAlB8B,EAEDpC,EAAEuB,MAAM,CACNc,MAAO,cACPC,QAAS,2DACTC,MAAO,OACPC,KAAM,MACNC,KAAM,8BACNC,QAAS,CACPC,GAAI,CACFC,SAAW,mBAOjB5C,EAAE,UAAU6C,MAAK,SAASC,IACsB,IAA3C9C,EAAE+C,MAAMC,OAAOtB,OAAOU,KAEvBlC,GAAsB,EAE1B,IAIGA,EACDF,EAAEiD,QAAQ,CACRZ,MAAO,cACPC,QAAS,uEACTC,MAAO,OACPC,KAAM,SACNC,KAAM,8BACNC,QAAS,CACPQ,IAAK,CACHN,SAAU,WACVO,KAAM,CAAC,SACPC,OAAQ,WAENjD,GACF,GAEFkD,IAAK,CACHT,SAAU,gBACVO,KAAM,CAAC,OACPC,OAAO,WACLpD,EAAE,mBAAmBsD,OACvB,MAMNnD,IAKN,IA6BAH,EAAE,kBAAkBmC,GAAG,QAAS,mBAAmB,WAGnCnC,EAAE+C,MAAMC,OAAtB,IAGInB,EADa7B,EAAE+C,MAAMQ,WAAWtD,KAAK,MACduD,MAAM,KAAK,GAElCC,EAAWzD,EAAE+C,MAAMW,SAASzD,KAAK,MAErCD,EAAE+C,MAAMY,UAEO,aAAZF,GAED3C,EAAce,EAAW,gBAEzB7B,EAAE,aAAe6B,GAAW+B,WAI5B9C,EAAce,EAAW,gBAEzB7B,EAAE,cAAgB6B,GAAW+B,SAGjC,G","sources":["webpack://parasitlab/./resources/js/melangeManager.js"],"sourcesContent":["\n// GESTION DE LA MODIFICATION DES MELANGES\n// Crée un nouvel animal dans un mélange ou ajoute ou retire un animal d'un mélange\n// On récupére l'url actuelle\nvar url_actuelle = window.location.protocol + \"//\" + window.location.host + window.location.pathname; // récupère l'adresse de la page actuelle\n// On récupère l'id du mélange pour la mise à jour\nvar melange_id = $(\"#liste-in\").attr('melange');\nvar troupeau_id = $('#liste-in').attr('troupeau')\n// On initialise la variable à faux\nvar animal_deja_present = false\n\n// Ajout d'un animal\n$(\"#add_animal\").on(\"click\", function() {\n  var numero_nouveau = $(\"#numero_nouveau\").val();\n  var nom_nouveau = $(\"#nom_nouveau\").val();\n  // Si le champs numero est vide, on ouvre une alert d'avertissement\n  if(numero_nouveau == '') {\n\n    $.alert({\n      title: \"Attention !\",\n      content: \"Il faut saisir au moins une valeur dans le champs numéro\",\n      theme: 'dark',\n      type: 'red',\n      icon: 'fas fa-exclamation-triangle',\n      buttons: {\n        OK: {\n          btnClass : 'btn-success',\n        }\n      }\n    });\n\n  } else {\n    // On passe en revue tous les numeros déjà existants\n    $('button').each(function(index) {\n      if($(this).html().search(numero_nouveau) !== -1) {\n        // On passe la variable à vrai\n        animal_deja_present = true;\n      }\n    })\n\n    // Si le nom saisi est déjà parmi les existants, on fait une alerte\n    // qui laisse la choix de l'enregister quand même.\n    if(animal_deja_present) {\n      $.confirm({\n        title: \"Attention !\",\n        content: \"Cet animal semble déjà exister, voulez-vous quand même l'enregistrer\",\n        theme: 'dark',\n        type: 'orange',\n        icon: 'fas fa-exclamation-triangle',\n        buttons: {\n          oui: {\n            btnClass: 'btn-blue',\n            keys: ['enter'],\n            action: function() {\n              // Si on veut tout de même l'enregistrer, on soumet le formulaire\n              formsubmit();\n            }\n          },\n          non: {\n            btnClass: 'btn-secondary',\n            keys: ['esc'],\n            action:function() {\n              $('#numero_nouveau').focus();\n            }\n          }\n        }\n      });\n    } else {\n      // On crée le nouvel animal\n      formsubmit();\n    }\n\n  }\n\n})\n\n// Met à jour la liste des animaux du mélange dans la BDD puis appelle la fonction\n// updateMelange qui met à jour la liste affichée à  l'écran\nfunction formsubmit() {\n\n  url = getUrl('api/melange/addAnimal');\n\n  $(\"#numero_nouveau\").attr('value', $(\"#numero_nouveau\").val());\n\n  $.post({\n    url: url,\n    data: $(\"#form_addAnimal\").serialize()\n  })\n  .done(function(data) {\n    var animal = JSON.parse(data);\n    // On met à jour le mélange en ajoutant cet animal dans la bdd (AJAX)\n    updateMelange(animal.id, 'addtomelange');\n    // On met à jour l'affichage\n    updateListeMelange(animal);\n\n  })\n  .fail(function(data) {\n    alert('il y a un problème !')\n  })\n}\n\n// Ajout ou suppression d'un animal du mélange\n// Quand on clique sur un animal\n$('.liste-animals').on('click', '.animal-melange', function() {\n\n  // On récupère le contenu\n  var contenu = $(this).html();\n  // On récupère le numéro de l'animal\n  var contenu_id = $(this).children().attr('id');\n  var animal_id = contenu_id.split('_')[1];\n  // On récupère l'id de la liste\n  var liste_id = $(this).parent().attr('id');\n  // On efface la ligne correspondante\n  $(this).fadeOut();\n  // Si on a cliqué sur un animal hors du mélange\n  if(liste_id == \"liste-out\") {\n    // On met à jour le mélange en ajoutant cet animal dans la bdd (AJAX)\n    updateMelange(animal_id, 'addtomelange');\n    // On affiche cette animal dans la liste In\n    $(\"#animalIn_\" + animal_id).fadeIn();\n    // Si on a cliqué sur un animal dans le mélange\n  } else {\n    // On l'enlève du mélange dans la BDD (AJAX)\n    updateMelange(animal_id, 'deltomelange');\n    // On l'affiche dans la liste hors mélange\n    $(\"#animalOut_\" + animal_id).fadeIn();\n  }\n\n})\n\n// Fonction qui renvoie l'url pour la requete AJAX\nfunction getUrl(route) {\n  // comme les url sont différente en local (avec /public/) et en distant\n  // et que il y deux façon de créer un nouvel animal dans un mélange (melange.create et melange.edit)\n  // Il faut repérer le position du mot laboratoire et modifier l'url en conséquence\n  var cesure = url_actuelle.search('laboratoire');\n  // cesure est la position de la lettre l dans l'url actuelle\n  // url_actuelle.sustring(cesure) est le fragment d'url à partir du l de laboratoire\n  return url_actuelle.replace( url_actuelle.substring(cesure), route);\n}\n\n// Met à jour le mélange dans la base de donnée par une requete ajax\n// Si addOrdel = 'addtomelange' c'est un ajout via la méthode DonneesController@addtomelange\n// Si addOrdel = 'deltomelange' c'est un retrait via la méthode DonneesController@deltomelange\nfunction updateMelange(animal_id, addOrdel) {\n\n  // Création de l'url de la requete AJAX (addtomelange pour ajout, deltomelange pour retrait)\n\n  url = getUrl(('api/melange/' + addOrdel));\n  // On construit un JSON\n  var data = {\n    \"melange_id\" : melange_id,\n    \"animal_id\" : animal_id\n  }\n\n  // Requete post sur DonneesController@maddtomelange\n  $.post({\n    url : url,\n    data: data,\n  })\n  .done(function(datas) {\n    console.log(\"Ok tout va bien\");\n  })\n  .fail(function(errors) {\n    console.log('ERREURS:' + errors);\n  })\n\n}\n\n// Met à jour la liste des animaux présents dans le mélange avec le retour ajax\n// de la fonction DonneesController@melangeUpdate\nfunction updateListeMelange(animal) {\n\n  // On ajoute une ligne visible dans les animaux du mélange\n  var ligne_in =\n    '<div id=\"animalIn_' + animal.id +\n    '\" class=\"animal-melange in-melange\">' +\n    '<button id=\"animal_' + animal.id + '\"' +\n    'class=\"m-1 p-3 border btn btn-info text-left w-100\" title=\"' + animal.id +' \">' +\n    animal.numero + ' ' + (animal.nom ? animal.nom : '') +\n    '</button></div>';\n\n  $('#liste-in').prepend(ligne_in);\n  // Et une ligne cachée dans les animaux hors du mélange\n  var ligne_out =\n    '<div id=\"animalOut_' + animal.id +\n    '\" class=\"animal-melange out-melange collapse\">' +\n    '<button id=\"animal_' + animal.id + '\"' +\n    'class=\"m-1 p-3 border btn btn-light text-left w-100\" title=\"' + animal.id +' \">' +\n    animal.numero + ' ' + (animal.nom ? animal.nom : '') +\n    '</button></div>';\n\n  $('#liste-out').prepend(ligne_out);\n}\n"],"names":["url_actuelle","window","location","protocol","host","pathname","melange_id","$","attr","animal_deja_present","formsubmit","url","getUrl","val","post","data","serialize","done","animal","JSON","parse","updateMelange","id","ligne_in","numero","nom","prepend","ligne_out","updateListeMelange","fail","alert","route","cesure","search","replace","substring","animal_id","addOrdel","datas","console","log","errors","on","numero_nouveau","title","content","theme","type","icon","buttons","OK","btnClass","each","index","this","html","confirm","oui","keys","action","non","focus","children","split","liste_id","parent","fadeOut","fadeIn"],"sourceRoot":""}